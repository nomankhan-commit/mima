
@{
    //ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    Html.RenderPartial("~/Views/Shared/navBar.cshtml");
}
@*<style>
       .form-control { display: inline-block !important; }

    </style>*@

<style>
    .form-control {
        border: 1px solid white;
        border-radius: 5px;
    }
</style>

<div class="row text-center">
    <div class="col-md-12"><img src="~/Content/img/mima-constructionLogo.png" /></div>
    <div class="col-md-12"><h3>Bank Payment Voucher</h3></div>

</div>
<div class="myDiv">
    <div class="row">

        <div class="col-md-12">

            @using (Html.BeginForm("bankPaymentVoucherSubmit", "Home", FormMethod.Post, new { id = "bankForm" }))
            {
                <div class="formInnerDiv">
                    <input type="checkbox" class="ispending-checkBox" name="isPending" value="true" id="isPending" style="display:none" />
                    @*Submit as a Pending*@

                    <div class="form-group">
                        <label for="email">V.no:</label>
                        <input type="text" class="form-control borderRem width-sm" id="Vnom" name="Vnumber" value="@ViewBag.vNum" autocomplete="off" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="pwd">Date:</label>
                        <input type="text" class="form-control borderRem width-sm" id="date" readonly name="Date" required autocomplete="off">
                    </div>


                    @*<div class="form-group">
                            <label for="sel1">Bank:</label>
                            <input type="text" class="form-control borderRem width-sm" id="BanksList" name="Bank">
                        </div>*@

                    <div class="form-group">
                        <label for="sel1">Bank list:</label>
                        <select class="form-control width-sm" id="getDataBybankId" name="Bank">

                            @{
                                foreach (var item in ViewBag.bank_Details)
                                {

                                    <option value="@item.Bank">@item.Bank</option>
                                }

                            }
                        </select>
                        <!--br-->

                    </div>
                    <div class="form-group">
                        <label for="sel1">Branch:</label>
                        <select class="form-control width-sm" id="branchDropDown" name="Branch">
                            <option value="0"> </option>
                            @*ViewBag.banksList*@
                            @{
                                foreach (var item in ViewBag.bank_Details)
                                {
                                    @*<option value="@item.id">@item.Bank1</option>*@
                                    <option value="@item.Branch">@item.Branch</option>
                                }

                            }
                        </select>
                        <!--br-->

                    </div>
                    <div class="form-group">
                        <label for="sel1">Org:</label>
                        <select class="form-control width-sm" id="orgDropDown" name="Org">
                            <option value="0"> </option>
                            @*ViewBag.banksList*@
                            @{
                                foreach (var item in ViewBag.bank_Details)
                                {
                                    @*<option value="@item.id">@item.Bank1</option>*@
                                    <option value="@item.Org">@item.Org</option>
                                }

                            }
                        </select>
                        <!--br-->

                    </div>

                    <div class="form-group">
                        <label for="sel1">Account:</label>
                        <select class="form-control width-sm" id="accountDropDown" name="Account">
                            @*<option value="0"> </option>*@
                            @*ViewBag.banksList*@
                            @{
                                foreach (var item in ViewBag.bank_Details)
                                {
                                    @*<option value="@item.id">@item.Bank1</option>*@
                                    <option value="@item.Account">@item.Account</option>
                                }

                            }
                        </select>
                        <!--br-->

                    </div>
                    <div class="form-group">
                        <label for="pwd">Cheque.no:</label>
                        <input type="text" class="form-control borderRem width-sm" id="pwd" name="ChequeNo" autocomplete="off" required>
                    </div>

                    @*importtant*@
                    @*<div class="form-group" id="AccoutnDiv" style="display:none">
                            <label for="sel1">Account list:</label>
                            <select class="form-control width-sm" id="accountDropDown" name="AccountID">

                            </select>
                            <br>

                        </div>*@
                </div>
                <div class="form-group">
                    <label for="sel1">Paid To:</label>
                    <select class="form-control borderRem width-lg" id="PaidTo" name="PaidTo">

                        @*ViewBag.banksList*@
                        @{
                            foreach (var item in ViewBag.paidTo)
                            {
                                @*<option value="@item.id">@item.Bank1</option>*@
                                <option value="@item.Paid_to">@item.Paid_to</option>
                            }

                        }
                    </select>
                    <!--br-->

                </div>
                <div class="form-group">
                    <label for="sel1">Control:</label>
                    <select class="form-control borderRem width-lg" id="Control" name="Control">

                        @*ViewBag.banksList*@
                        @{
                            foreach (var item in ViewBag.ControlDetails)
                            {
                                @*<option value="@item.id">@item.Bank1</option>*@
                                <option value="@item.Control">@item.Control</option>
                            }

                        }
                    </select>
                    <!--br-->

                </div>
                @*<div class="form-group">
                        <label for="pwd">Paid To:</label>
                        <input type="text" class="form-control borderRem width-lg" id="pwd" autocomplete="off" name="PaidTo" required>
                    </div>*@
                            @*<div class="form-group">
                                    <label for="pwd">Control:</label>
                                    <input type="text" class="form-control borderRem width-lg" id="pwd" name="Control" required>
                                </div>*@
                            <div class=""></div>
                            <div class="form-group">
                                <label for="pwd">Amount:</label>
                                <input type="text" class="form-control borderRem width-lg" autocomplete="off" onkeyup="amount.innerHTML=convertNumberToWords(this.value)" id="amount" name="Amount" required>
                            </div>

                            <div class="form-group">
                                <label for="pwd">Rupees:</label>
                                <input type="text" class="form-control borderRem width-lg" autocomplete="off" id="rupees" readonly name="Rupees" required>
                            </div>
                            <div class="form-group">
                                <label for="pwd">Description:</label>
                                <input type="text" class="form-control borderRem width-lg" autocomplete="off" id="Description" name="Description" required>
                            </div>


                            @*<button type="button" id="printPdf" class="btn btn-success submitBtn">Print</button>*@
                            @*<button type="submit" class="btn btn-primary">Submit</button>*@
                            @*<button type="button" id="resetBtn" class="btn btn-danger">Reset</button>
                            <button type="submit" class="btn btn-light btnPending">Pending</button>*@


                            }

        </div>
    </div>
    <div id="editor"></div>
</div>
<script>

    // numeral
    document.addEventListener('DOMContentLoaded', () => {
        const cleave = new Cleave('.amount', {
            numeral: true,
            numeralThousandsGroupStyle: 'thousand'
        });
    });

    $(document).ready(function () {
        $('input').prop('readonly', true);
        $('select'). prop('disabled', true);
        //$("body").css("background-color", "#FFC0CB");
        debugger;
        @*var VoucherNom = @Html.Raw(ViewBag.vNum);
        $("#Vnom").val("000"+VoucherNom);*@

        $(".btnPending").hover(function(){
            //$('#bankForm').attr('action', '/Home/PendingSubmit');
            //$("#isPending").val(1)
            $("#isPending"). prop("checked", true);

        }, function(){
            //$('#bankForm').attr('action', '/Home/bankPaymentVoucherSubmit');
            //$("#isPending").val(0)
            $("#isPending"). prop("checked", false);
        });
        $("#printPdf").click(function () {


            AJaxHelper.AjaxReqProcessor($("form").serialize(), false, 'Json', 'Post', 'sharting', 'Index');
            if (AJaxHelper.result!= null) {

            }


        })


        $("#resetBtn").click(function(){

            window.location.href = "/Home/PaymentForm";
        })

        var formData =@Html.Raw(ViewBag.Data);

        $("input[name=id]").val(formData[0].id)
        $("input[name=Vnumber]").val(formData[0].Vnumber)
        $("input[name=Date]").val(formData[0].Date)
        $("input[name=ChequeNo]").val(formData[0].ChequeNo)

        $("input[name=Amount]").val(formData[0].Amount)
        $("input[name=Description]").val(formData[0].Description)
        $("input[name=Rupees]").val(formData[0].Rupees)
        $("input[name=filterDate]").val(formData[0].filterDate)
        $("input[name=createAT]").val(formData[0].createAT)

        $("#PaidTo option").each(function () {
            if ($(this).val() == formData[0].PaidTo)
                $(this).attr("selected", "selected");
        });

        $("#Control option").each(function () {
            if ($(this).val() == formData[0].Control)
                $(this).attr("selected", "selected");
        });


        $("#getDataBybankId option").each(function () {
            if ($(this).val() == formData[0].Bank)
                $(this).attr("selected", "selected");
        });

        $("#branchDropDown option").each(function () {
            if ($(this).val() == formData[0].Branch)
                $(this).attr("selected", "selected");
        });
        $("#orgDropDown option").each(function () {
            if ($(this).val() == formData[0].Org)
                $(this).attr("selected", "selected");
        });

        $("#accountDropDown option").each(function () {
            if ($(this).val() == formData[0].Account)
                $(this).attr("selected", "selected");
        });


    })//end document .ready

    $(document).ready(function() {
        @*debugger;
        var BankList = @Html.Raw(ViewBag.banksList);
      console.log(BankList);
        $( "#BanksList" ).autocomplete({
            source: BankList

        });*@



        //--------date work--------//
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth());
        var yyyy = today.getFullYear()

        const monthNames = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
        ];

        var month =monthNames[today.getMonth()];
        var todayDate=dd+"/"+month+"/"+yyyy

        $("#date").val(todayDate);
        //--------date work--------//


        var resutl = [];
        //----according to bank bind three dropdownlist branch, org, account----//
        $('#getDataBybankId').change(function () {
            BindDropdowns(1, "#getDataBybankId", null, null);
        })
        //----according to bank bing three dropdownlist branch, org, account----//

        //---- according bank and branch bind two dropdownlist org and account----//
        $('#branchDropDown').change(function () {
            BindDropdowns(2, "#getDataBybankId", "#branchDropDown", null);
        })
        //---- according bank and branch bind two dropdownlist org and account----//

        //---- according bank and branch and org bind one dropdown account ----//
        $('#orgDropDown').change(function () {
            BindDropdowns(3, "#getDataBybankId", "#branchDropDown", "#orgDropDown");
        })
        //---- according bank and branch and org bind one dropdown account ----//

        new Cleave('input[name=Amount]', {
            numeral: true,
            numeralThousandsGroupStyle: 'thousand'
        });

    });


    //------amount to words------//

    function convertNumberToWords(amount) {
        var words = new Array();
        words[0] = '';
        words[1] = 'One';
        words[2] = 'Two';
        words[3] = 'Three';
        words[4] = 'Four';
        words[5] = 'Five';
        words[6] = 'Six';
        words[7] = 'Seven';
        words[8] = 'Eight';
        words[9] = 'Nine';
        words[10] = 'Ten';
        words[11] = 'Eleven';
        words[12] = 'Twelve';
        words[13] = 'Thirteen';
        words[14] = 'Fourteen';
        words[15] = 'Fifteen';
        words[16] = 'Sixteen';
        words[17] = 'Seventeen';
        words[18] = 'Eighteen';
        words[19] = 'Nineteen';
        words[20] = 'Twenty';
        words[30] = 'Thirty';
        words[40] = 'Forty';
        words[50] = 'Fifty';
        words[60] = 'Sixty';
        words[70] = 'Seventy';
        words[80] = 'Eighty';
        words[90] = 'Ninety';
        amount = amount.toString();
        var atemp = amount.split(".");
        var number = atemp[0].split(",").join("");
        var n_length = number.length;
        var words_string = "";
        if (n_length <= 9) {
            var n_array = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0);
            var received_n_array = new Array();
            for (var i = 0; i < n_length; i++) {
                received_n_array[i] = number.substr(i, 1);
            }
            for (var i = 9 - n_length, j = 0; i < 9; i++, j++) {
                n_array[i] = received_n_array[j];
            }
            for (var i = 0, j = 1; i < 9; i++, j++) {
                if (i == 0 || i == 2 || i == 4 || i == 7) {
                    if (n_array[i] == 1) {
                        n_array[j] = 10 + parseInt(n_array[j]);
                        n_array[i] = 0;
                    }
                }
            }
            value = "";
            for (var i = 0; i < 9; i++) {
                if (i == 0 || i == 2 || i == 4 || i == 7) {
                    value = n_array[i] * 10;
                } else {
                    value = n_array[i];
                }
                if (value != 0) {
                    words_string += words[value] + " ";
                }
                if ((i == 1 && value != 0) || (i == 0 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Crores ";
                }
                if ((i == 3 && value != 0) || (i == 2 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Lakhs ";
                }
                if ((i == 5 && value != 0) || (i == 4 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Thousand ";
                }
                if (i == 6 && value != 0 && (n_array[i + 1] != 0 && n_array[i + 2] != 0)) {
                    words_string += "Hundred and ";
                } else if (i == 6 && value != 0) {
                    words_string += "Hundred ";
                }
            }
            words_string = words_string.split("  ").join(" ");
        }

        $('#rupees').val(words_string);
        return words_string;


    }

    //------amount to words------//


    function BindDropdowns(type, bankdropdownId, branchdropdownId, OrgdropdownId) {
        var drow;
        var branchDrow;
        var orgDrow;
        var accountDrow;
        var Bank_ = $(bankdropdownId + " option:selected").val();
        var Branch_ = $(branchdropdownId + " option:selected").val();
        var Org_ = $(OrgdropdownId + " option:selected").val();
        var objforcontroller = {};
        objforcontroller.Bank = $.trim(Bank_);
        objforcontroller.Branck = $.trim(Branch_);
        objforcontroller.org = $.trim(Org_);
        objforcontroller.type = type;
        AJaxHelper.AjaxReqProcessor(objforcontroller, false, 'Json', 'Post', 'Home', 'AccountsByBankId');
        resutl = AJaxHelper.result;
        debugger;
        var obj = JSON.parse(resutl);
        let branchDropDown = $('#branchDropDown');
        let orgDropDown = $('#orgDropDown');
        let accountDropDown = $('#accountDropDown');
        if (obj.length == 0) {
            branchDropDown.empty();
            orgDropDown.empty();
            accountDropDown.empty();
            branchDropDown.append('<option selected="true" disabled>no record found</option>');
            orgDropDown.append('<option selected="true" disabled>no record found</option>');
            accountDropDown.append('<option selected="true" disabled>no record found</option>');
            branchDropDown.prop('selectedIndex', 0);
            orgDropDown.prop('selectedIndex', 0);
            accountDropDown.prop('selectedIndex', 0);
        } else {
            for (var i = 0; i < obj.length; i++) {
                branchDrow += '<option value="' + obj[i].Branch + '">' + obj[i].Branch + '</option>'
                orgDrow += '<option value="' + obj[i].Org + '">' + obj[i].Org + '</option>'
                accountDrow += '<option value="' + obj[i].Account + '">' + obj[i].Account + '</option>'
            }
            if (type=='1') {
                branchDropDown.empty();
                branchDropDown.html(branchDrow)
                orgDropDown.empty();
                orgDropDown.append(orgDrow)
                accountDropDown.empty();
                accountDropDown.append(accountDrow)
            }
            else if(type =='2') {
                orgDropDown.empty();
                orgDropDown.append(orgDrow)
                accountDropDown.empty();
                accountDropDown.append(accountDrow)
            } else if (type == '3') {
                accountDropDown.empty();
                accountDropDown.append(accountDrow)

            } else {

                return false;
            }
        }




    }


</script>